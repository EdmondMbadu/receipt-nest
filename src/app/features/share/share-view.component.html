<div class="min-h-screen bg-gradient-to-b from-slate-50 to-white px-4 py-6 sm:px-6 lg:px-8">
  <div class="mx-auto flex max-w-4xl flex-col gap-6">
    <header
      class="flex flex-col gap-3 rounded-3xl border border-slate-200 bg-white/90 p-4 shadow-sm sm:flex-row sm:items-center sm:justify-between dark:border-slate-800 dark:bg-slate-900/90">
      <a routerLink="/" class="flex items-center gap-3">
        <img src="assets/receipt-nest.png" alt="ReceiptNest" class="h-12 w-12 rounded-2xl border border-slate-200 p-2">
        <div>
          <p class="text-xs uppercase tracking-[0.2em] text-emerald-600 dark:text-emerald-300">ReceiptNest</p>
          <p class="text-sm font-semibold text-slate-900 dark:text-white">Shared snapshot</p>
        </div>
      </a>
      <div class="flex flex-wrap items-center gap-2">
        <button type="button" (click)="toggleTheme()"
          class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 text-lg text-slate-700 transition hover:border-emerald-300 hover:text-emerald-700 dark:border-slate-700 dark:text-slate-200"
          aria-label="Toggle theme">
          {{ isDarkMode() ? '‚òÄÔ∏è' : 'üåô' }}
        </button>
        <a routerLink="/register"
          class="inline-flex items-center justify-center gap-2 rounded-full bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow shadow-emerald-500/30 transition hover:bg-emerald-600">
          Join ReceiptNest
        </a>
        <a routerLink="/login"
          class="inline-flex items-center justify-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-emerald-200 hover:text-emerald-700 dark:border-slate-700 dark:text-slate-200 dark:hover:border-emerald-500 dark:hover:text-emerald-300">
          Log in
        </a>
      </div>
    </header>

    <section
      class="rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-xl shadow-slate-200/60 dark:border-slate-800 dark:bg-slate-900/95 dark:shadow-none">
      <div *ngIf="isLoading()" class="flex flex-col items-center justify-center gap-3 py-12 text-center">
        <div class="h-10 w-10 animate-spin rounded-full border-4 border-emerald-500 border-t-transparent"></div>
        <p class="text-sm text-slate-500 dark:text-slate-400">Loading shared graph...</p>
      </div>

      <div *ngIf="!isLoading() && error()" class="flex flex-col items-center gap-4 text-center">
        <div class="rounded-2xl bg-red-50 px-4 py-3 text-sm text-red-600 dark:bg-red-950/30 dark:text-red-200">
          {{ error() }}
        </div>
        <a routerLink="/"
          class="inline-flex items-center gap-2 text-sm font-semibold text-emerald-600 hover:text-emerald-700">
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Back to ReceiptNest
        </a>
      </div>

      <ng-container *ngIf="!isLoading() && !error() && share() as publicShare">
        <div class="space-y-6">
          <div *ngIf="isGraphShare()">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Spending snapshot</p>
            <h1 class="mt-2 text-3xl font-semibold text-slate-900 dark:text-white">{{ monthLabel() }}</h1>
            <p class="text-lg text-slate-500 dark:text-slate-400">Total spent:
              <span class="font-semibold text-slate-900 dark:text-white">{{ formatCurrency(totalSpend()) }}</span>
            </p>
            <div class="mt-2 text-sm text-slate-500 dark:text-slate-400 space-y-1" *ngIf="includeName() || includeEmail()">
              <p *ngIf="includeName()">
                Shared by
                <span class="font-medium text-slate-900 dark:text-white">{{ publicShare.shareType === 'graph' ? publicShare.ownerName : '' }}</span>
              </p>
              <p *ngIf="includeEmail()">
                Contact <a [href]="'mailto:' + (publicShare.shareType === 'graph' ? publicShare.ownerEmail : '')" class="text-emerald-600 hover:underline">{{ publicShare.shareType === 'graph' ? publicShare.ownerEmail : '' }}</a>
              </p>
            </div>
          </div>

          <div *ngIf="isChatShare()">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Shared conversation</p>
            <h1 class="mt-2 text-2xl font-semibold text-slate-900 dark:text-white">{{ chatTitle() }}</h1>
            <p class="text-sm text-slate-500 dark:text-slate-400">
              View-only chat transcript
            </p>
          </div>

          <div *ngIf="isGraphShare()"
            class="rounded-2xl border border-slate-200 bg-gradient-to-b from-white via-white to-slate-50 p-5 dark:border-slate-800 dark:from-slate-900 dark:via-slate-900 dark:to-slate-950">
            <div class="flex flex-col gap-1">
              <p class="text-sm font-medium text-slate-500 dark:text-slate-400">Monthly total</p>
              <p class="text-3xl font-semibold text-emerald-600 dark:text-emerald-400">{{ formatCurrency(totalSpend()) }}</p>
              <p class="text-xs text-slate-400">Hover over the graph to view daily totals.</p>
            </div>

            <div class="relative mt-6 h-40" (mouseleave)="hoveredDay.set(null)" (touchend)="hoveredDay.set(null)">
              <svg class="h-full w-full" viewBox="0 0 200 100" preserveAspectRatio="none">
                <defs>
                  <linearGradient id="sharedSpendingGradient" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="#10b981" stop-opacity="0.2"></stop>
                    <stop offset="100%" stop-color="#10b981" stop-opacity="0.05"></stop>
                  </linearGradient>
                </defs>
                <path [attr.d]="chartPathData().areaPath" fill="url(#sharedSpendingGradient)"></path>
                <path [attr.d]="chartPathData().linePath" fill="none" stroke="#10b981" stroke-width="1.5"
                  stroke-linecap="round" stroke-linejoin="round"></path>
                <circle *ngIf="hoveredDay()" [attr.cx]="getChartX(hoveredDay()!.day)" [attr.cy]="getChartY(hoveredDay()!.amount)"
                  r="3" fill="#10b981" stroke="#fff" stroke-width="1.5"></circle>
              </svg>
              <div class="absolute inset-0 z-10 flex">
                <div *ngFor="let day of dailyData()" class="flex-1 cursor-pointer"
                  (mouseenter)="hoveredDay.set(day)" (touchstart)="hoveredDay.set(day)">
                </div>
              </div>
              <div *ngIf="hoveredDay()" class="absolute top-0 bottom-0 w-px bg-emerald-500/50"
                [style.left.%]="((hoveredDay()!.day - 1) / (dailyData().length - 1 || 1)) * 100"></div>
            </div>

            <div class="mt-3 flex justify-between text-[10px] uppercase tracking-[0.2em] text-slate-400">
              <span>Day 1</span>
              <span>Day {{ axisLabel(Math.ceil(dailyData().length / 2)) }}</span>
              <span>Day {{ dailyData().length }}</span>
            </div>

            <div class="mt-4 rounded-xl bg-white/80 px-4 py-3 text-sm text-slate-600 shadow-sm dark:bg-slate-900/60 dark:text-slate-300">
              <p *ngIf="hoveredDay(); else totalLabel">
                Day {{ hoveredDay()!.day }} spending:
                <span class="font-semibold text-slate-900 dark:text-white">{{ formatCurrency(hoveredDay()!.amount) }}</span>
              </p>
              <ng-template #totalLabel>
                <p>This chart includes {{ dailyData().length }} days of spending data.</p>
              </ng-template>
            </div>
          </div>

          <div *ngIf="isChatShare()"
            class="rounded-2xl border border-slate-200 bg-gradient-to-b from-white via-white to-slate-50 p-5 dark:border-slate-800 dark:from-slate-900 dark:via-slate-900 dark:to-slate-950">
            <div class="space-y-3">
              <div *ngFor="let message of chatMessages()"
                class="flex"
                [class.justify-end]="message.role === 'user'"
                [class.justify-start]="message.role === 'assistant'">
                <div class="max-w-[85%] sm:max-w-[75%]">
                  <div
                    class="rounded-2xl px-4 py-3 text-sm shadow-sm"
                    [class.bg-emerald-600]="message.role === 'user'"
                    [class.text-white]="message.role === 'user'"
                    [class.border]="message.role === 'assistant'"
                    [class.border-slate-200]="message.role === 'assistant'"
                    [class.bg-white]="message.role === 'assistant'"
                    [class.text-slate-700]="message.role === 'assistant'"
                    [class.dark:border-slate-700]="message.role === 'assistant'"
                    [class.dark:bg-slate-900]="message.role === 'assistant'"
                    [class.dark:text-slate-200]="message.role === 'assistant'">
                    <p class="whitespace-pre-wrap">{{ message.content }}</p>
                  </div>
                  <p class="mt-1 px-2 text-[10px] text-slate-400" [class.text-right]="message.role === 'user'">
                    {{ formatChatTime(message.timestamp) }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div
            class="flex flex-col gap-4 rounded-2xl border border-slate-200 bg-slate-900 px-6 py-5 text-white shadow-lg dark:border-slate-800">
            <div>
              <p class="text-sm uppercase tracking-[0.25em] text-emerald-200">Loved what you see?</p>
              <h2 class="mt-2 text-2xl font-semibold">Join ReceiptNest for unlimited sharing & receipt tracking.</h2>
              <p class="mt-2 text-sm text-slate-200">
                Upload receipts, categorize spending, and share live graphs with clients or teammates in seconds.
              </p>
            </div>
            <div class="flex flex-wrap gap-3">
              <a routerLink="/register"
                class="inline-flex flex-1 items-center justify-center gap-2 rounded-full bg-white px-4 py-2 text-sm font-semibold text-slate-900 transition hover:bg-slate-100 sm:flex-none sm:px-6">
                Create free account
              </a>
              <a routerLink="/login"
                class="inline-flex flex-1 items-center justify-center gap-2 rounded-full border border-white/40 px-4 py-2 text-sm font-semibold text-white transition hover:border-white sm:flex-none sm:px-6">
                Log in
              </a>
            </div>
          </div>
        </div>
      </ng-container>
    </section>
  </div>
</div>
