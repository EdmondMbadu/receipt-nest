<div class="min-h-screen bg-white dark:bg-slate-950">
  <div class="mx-auto max-w-6xl px-4 py-8 sm:px-6 lg:px-8 space-y-6">
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <p class="text-xs font-semibold uppercase tracking-wider text-emerald-600 dark:text-emerald-400">Admin</p>
        <h1 class="text-2xl font-semibold text-slate-900 dark:text-white">User directory</h1>
        <p class="text-sm text-slate-500 dark:text-slate-400">All registered accounts in ReceiptNest AI.</p>
      </div>
      <a routerLink="/app"
        class="inline-flex items-center gap-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 shadow-sm transition-colors hover:bg-slate-50 dark:hover:bg-slate-800">
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12l7.5-7.5M3 12h18" />
        </svg>
        <span>Back to dashboard</span>
      </a>
    </div>

    <div class="grid gap-4 sm:grid-cols-3">
      <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 p-4 shadow-sm">
        <p class="text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Total users</p>
        <p class="mt-2 text-2xl font-semibold text-slate-900 dark:text-white">{{ totalUsers() }}</p>
      </div>
      <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 p-4 shadow-sm">
        <p class="text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Admins</p>
        <p class="mt-2 text-2xl font-semibold text-slate-900 dark:text-white">{{ adminCount() }}</p>
      </div>
      <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 p-4 shadow-sm">
        <p class="text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Pro plans</p>
        <p class="mt-2 text-2xl font-semibold text-slate-900 dark:text-white">{{ proCount() }}</p>
      </div>
    </div>

    <details class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm overflow-hidden">
      <summary
        class="flex cursor-pointer items-center justify-between gap-4 px-4 py-3 text-sm font-semibold text-slate-900 dark:text-white list-none">
        <span>Test email</span>
        <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
        </svg>
      </summary>
      <div class="border-t border-slate-100 dark:border-slate-800 px-4 py-4 space-y-4">
        <p class="text-sm text-slate-500 dark:text-slate-400">
          Send a quick test email from info@receipt-nest.com.
        </p>
        <div class="grid gap-4 sm:grid-cols-2">
          <label class="text-sm text-slate-600 dark:text-slate-300">
            To email
            <input type="email" [ngModel]="testEmailTo()" (ngModelChange)="testEmailTo.set($event)"
              placeholder="you@example.com"
              class="mt-2 w-full rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-white placeholder-slate-400 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" />
          </label>
          <label class="text-sm text-slate-600 dark:text-slate-300">
            Subject
            <input type="text" [ngModel]="testEmailSubject()" (ngModelChange)="testEmailSubject.set($event)"
              class="mt-2 w-full rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-white placeholder-slate-400 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" />
          </label>
        </div>
        <label class="text-sm text-slate-600 dark:text-slate-300">
          Message
          <textarea rows="4" [ngModel]="testEmailMessage()" (ngModelChange)="testEmailMessage.set($event)"
            class="mt-2 w-full rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-white placeholder-slate-400 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/20"></textarea>
        </label>
        <div class="flex flex-wrap items-center gap-3">
          <button type="button" (click)="sendTestEmail()" [disabled]="testEmailSending()"
            class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-emerald-500 disabled:cursor-not-allowed disabled:opacity-60">
            <svg *ngIf="!testEmailSending()" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"
              stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 12l1.5 1.5 3-3" />
            </svg>
            <svg *ngIf="testEmailSending()" class="h-4 w-4 animate-spin" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 12a9 9 0 11-6.219-8.56" />
            </svg>
            <span>{{ testEmailSending() ? 'Sending...' : 'Send test email' }}</span>
          </button>
          <span *ngIf="testEmailSuccess()" class="text-sm text-emerald-600 dark:text-emerald-400">
            {{ testEmailSuccess() }}
          </span>
          <span *ngIf="testEmailError()" class="text-sm text-rose-600 dark:text-rose-400">
            {{ testEmailError() }}
          </span>
        </div>
      </div>
    </details>

    <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm overflow-hidden">
      <div class="flex items-center justify-between border-b border-slate-100 dark:border-slate-800 px-4 py-3">
        <h2 class="text-sm font-semibold text-slate-900 dark:text-white">Users</h2>
        <span class="text-xs text-slate-500 dark:text-slate-400" *ngIf="isLoading()">Loading...</span>
      </div>

      <div *ngIf="error()"
        class="px-4 py-6 text-sm text-rose-600 dark:text-rose-400">
        {{ error() }}
      </div>

      <div *ngIf="!isLoading() && !error() && users().length === 0"
        class="px-4 py-6 text-sm text-slate-500 dark:text-slate-400">
        No users found yet.
      </div>

      <div *ngIf="!isLoading() && users().length > 0" class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-100 dark:divide-slate-800">
          <thead class="bg-slate-50 dark:bg-slate-900/60">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Name</th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Email</th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Role</th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Plan</th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Created</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
            <tr *ngFor="let user of users()" class="hover:bg-slate-50/70 dark:hover:bg-slate-800/40">
              <td class="px-4 py-3 text-sm font-medium text-slate-900 dark:text-white">
                {{ displayName(user) }}
              </td>
              <td class="px-4 py-3 text-sm text-slate-500 dark:text-slate-400">
                {{ user.email }}
              </td>
              <td class="px-4 py-3 text-sm">
                <span
                  class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold"
                  [class.bg-emerald-100]="user.role === 'admin'"
                  [class.text-emerald-700]="user.role === 'admin'"
                  [class.bg-slate-100]="user.role !== 'admin'"
                  [class.text-slate-600]="user.role !== 'admin'"
                  [class.dark:bg-emerald-900/30]="user.role === 'admin'"
                  [class.dark:text-emerald-300]="user.role === 'admin'"
                  [class.dark:bg-slate-800]="user.role !== 'admin'"
                  [class.dark:text-slate-300]="user.role !== 'admin'">
                  {{ user.role || 'user' }}
                </span>
              </td>
              <td class="px-4 py-3 text-sm text-slate-500 dark:text-slate-400">
                {{ user.subscriptionPlan || 'free' }}
              </td>
              <td class="px-4 py-3 text-sm text-slate-500 dark:text-slate-400">
                {{ formatDate(user.createdAt) }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
